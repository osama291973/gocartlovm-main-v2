# Autofill Feature - Visual Implementation Guide

## 1. Current Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          GOCART ECOMMERCE APP                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚                          â”‚   React Frontend     â”‚                           â”‚
â”‚                          â”‚  (Vite + TypeScript) â”‚                           â”‚
â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚                                    â”‚                                        â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚                    â”‚               â”‚                â”‚                       â”‚
â”‚             â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚             â”‚ AddProductPageâ”‚  â”‚   LanguageÎ¨ â”‚  â”‚ AuthContext    â”‚        â”‚
â”‚             â”‚   Component   â”‚  â”‚  Context    â”‚  â”‚                â”‚        â”‚
â”‚             â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                    â”‚                                                        â”‚
â”‚                    â”‚ handleAutofillFromImages()                             â”‚
â”‚                    â–¼                                                        â”‚
â”‚             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚             â”‚ generateProductFromImage.ts â­   â”‚  (FIXED)                   â”‚
â”‚             â”‚  - Load env variables            â”‚                            â”‚
â”‚             â”‚  - Construct URL dynamically     â”‚                            â”‚
â”‚             â”‚  - Add ALL headers âœ…            â”‚                            â”‚
â”‚             â”‚  - Send fetch request            â”‚                            â”‚
â”‚             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚                            â”‚                                               â”‚
â”‚                            â”‚ HTTPS with Headers:                            â”‚
â”‚                            â”‚ âœ… Authorization                               â”‚
â”‚                            â”‚ âœ… apikey                                       â”‚
â”‚                            â”‚ âœ… x-client-info                                â”‚
â”‚                            â”‚ âœ… Content-Type                                 â”‚
â”‚                            â–¼                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â”‚ ğŸŒ HTTPS Encrypted
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SUPABASE INFRASTRUCTURE                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚              Supabase Project: qlhpzsucftqcakiotgpc          â”‚           â”‚
â”‚  â”‚                                                              â”‚           â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚           â”‚
â”‚  â”‚  â”‚         Edge Function (Deno Runtime)               â”‚    â”‚           â”‚
â”‚  â”‚  â”‚    generate_product_from_image/index.ts            â”‚    â”‚           â”‚
â”‚  â”‚  â”‚                                                     â”‚    â”‚           â”‚
â”‚  â”‚  â”‚  1. Receive request with headers âœ…                â”‚    â”‚           â”‚
â”‚  â”‚  â”‚  2. Validate CORS & authentication                 â”‚    â”‚           â”‚
â”‚  â”‚  â”‚  3. Extract imageUrl, storeId, language            â”‚    â”‚           â”‚
â”‚  â”‚  â”‚  4. Get OPENAI_API_KEY from env vars               â”‚    â”‚           â”‚
â”‚  â”‚  â”‚  5. Call OpenAI Vision API                         â”‚    â”‚           â”‚
â”‚  â”‚  â”‚  6. Parse AI response                              â”‚    â”‚           â”‚
â”‚  â”‚  â”‚  7. Return success response                        â”‚    â”‚           â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚           â”‚
â”‚  â”‚                      â”‚                                       â”‚           â”‚
â”‚  â”‚                      â”‚ OpenAI API Call                       â”‚           â”‚
â”‚  â”‚                      â–¼                                       â”‚           â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚           â”‚
â”‚  â”‚  â”‚   OpenAI Vision API (External)                       â”‚   â”‚           â”‚
â”‚  â”‚  â”‚   POST /v1/chat/completions                         â”‚   â”‚           â”‚
â”‚  â”‚  â”‚   - Model: gpt-4o-mini                              â”‚   â”‚           â”‚
â”‚  â”‚  â”‚   - Image: Analyze product from URL                 â”‚   â”‚           â”‚
â”‚  â”‚  â”‚   - Response: Product name + description            â”‚   â”‚           â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚           â”‚
â”‚  â”‚                      â”‚                                       â”‚           â”‚
â”‚  â”‚                      â”‚ Response (JSON)                       â”‚           â”‚
â”‚  â”‚                      â–¼                                       â”‚           â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚           â”‚
â”‚  â”‚  â”‚ Response Handler in Edge Function                   â”‚   â”‚           â”‚
â”‚  â”‚  â”‚ - Parse OpenAI response                             â”‚   â”‚           â”‚
â”‚  â”‚  â”‚ - Structure in app format                           â”‚   â”‚           â”‚
â”‚  â”‚  â”‚ - Return JSON to frontend                           â”‚   â”‚           â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚           â”‚
â”‚  â”‚                                                              â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â”‚ HTTPS Response (JSON)
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         FRONTEND (Result Display)                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  generateProductFromImage.ts                                                â”‚
â”‚  â”œâ”€ Parse response data                                                     â”‚
â”‚  â”œâ”€ Check success flag                                                      â”‚
â”‚  â””â”€ Return: {success: true, generated: {...}}                              â”‚
â”‚                                                                              â”‚
â”‚         â†“                                                                    â”‚
â”‚                                                                              â”‚
â”‚  AddProductPage.tsx handleAutofillFromImages()                              â”‚
â”‚  â”œâ”€ Receive response                                                        â”‚
â”‚  â”œâ”€ Update form state:                                                      â”‚
â”‚  â”‚  - formData.enName = generated.en.name                                    â”‚
â”‚  â”‚  - formData.enDescription = generated.en.description                     â”‚
â”‚  â”‚  - formData.arName = generated.ar.name                                   â”‚
â”‚  â”‚  - formData.arDescription = generated.ar.description                     â”‚
â”‚  â”œâ”€ Show success toast                                                      â”‚
â”‚  â””â”€ Re-render form with populated fields                                    â”‚
â”‚                                                                              â”‚
â”‚         â†“                                                                    â”‚
â”‚                                                                              â”‚
â”‚  âœ… User sees auto-filled product information                               â”‚
â”‚     Can edit before saving                                                  â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 2. Request/Response Payload Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            FRONTEND REQUEST PAYLOAD                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                     â”‚
â”‚ Method: POST                                        â”‚
â”‚ URL: https://qlhpzsucftqcakiotgpc                   â”‚
â”‚      .functions.supabase.co                         â”‚
â”‚      /generate_product_from_image                   â”‚
â”‚                                                     â”‚
â”‚ â”Œâ”€ HEADERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚                                                â”‚  â”‚
â”‚ â”‚ Content-Type: application/json                â”‚  â”‚
â”‚ â”‚ Authorization: Bearer                          â”‚  â”‚
â”‚ â”‚   eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...    â”‚  â”‚
â”‚ â”‚ apikey: eyJhbGciOiJIUzI1NiIsInR5cCI6Ikp...  â”‚  â”‚
â”‚ â”‚ x-client-info: gocart-frontend                â”‚  â”‚
â”‚ â”‚                                                â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                     â”‚
â”‚ â”Œâ”€ BODY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚                                                â”‚  â”‚
â”‚ â”‚ {                                              â”‚  â”‚
â”‚ â”‚   "imageUrl": "https://qlhpzsucftqcakiotgpc"  â”‚  â”‚
â”‚ â”‚     .supabase.co/storage/v1/object/public/...", â”‚
â”‚ â”‚   "storeId": "02c7be7e-c444-49fe-b0ad-9930",  â”‚  â”‚
â”‚ â”‚   "language": "en"                             â”‚  â”‚
â”‚ â”‚ }                                              â”‚  â”‚
â”‚ â”‚                                                â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            EDGE FUNCTION RESPONSE PAYLOAD                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚ Status: 200 OK                                              â”‚
â”‚ Content-Type: application/json                              â”‚
â”‚                                                             â”‚
â”‚ â”Œâ”€ RESPONSE BODY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚                                                       â”‚  â”‚
â”‚ â”‚ {                                                     â”‚  â”‚
â”‚ â”‚   "success": true,                                    â”‚  â”‚
â”‚ â”‚   "generated": {                                      â”‚  â”‚
â”‚ â”‚     "en": {                                           â”‚  â”‚
â”‚ â”‚       "name": "Premium Wireless Headphones",          â”‚  â”‚
â”‚ â”‚       "description": "High-quality audio with...      â”‚  â”‚
â”‚ â”‚                     noise cancellation technology     â”‚  â”‚
â”‚ â”‚                     for immersive listening...",      â”‚  â”‚
â”‚ â”‚       "slug": "premium-wireless-headphones"           â”‚  â”‚
â”‚ â”‚     },                                                â”‚  â”‚
â”‚ â”‚     "ar": {                                           â”‚  â”‚
â”‚ â”‚       "name": "Ø³Ù…Ø§Ø¹Ø§Øª Ø±Ø£Ø³ Ù„Ø§Ø³Ù„ÙƒÙŠØ© Ù…ØªÙ…ÙŠØ²Ø©",            â”‚  â”‚
â”‚ â”‚       "description": "ØµÙˆØª Ø¹Ø§Ù„ÙŠ Ø§Ù„Ø¬ÙˆØ¯Ø© Ù…Ø¹ Ø¥Ù„ØºØ§Ø¡...", â”‚  â”‚
â”‚ â”‚     }                                                 â”‚  â”‚
â”‚ â”‚   },                                                  â”‚  â”‚
â”‚ â”‚   "provider": "openai"                                â”‚  â”‚
â”‚ â”‚ }                                                     â”‚  â”‚
â”‚ â”‚                                                       â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 3. Environment Variables Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  .env File       â”‚
â”‚  (Git Ignored)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚ Vite Build Process
          â”‚ Injects vars at build time
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Vite Configuration                      â”‚
â”‚  Loads VITE_* prefixed variables         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚ Available at runtime via:
          â”‚ import.meta.env.VITE_*
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Browser Environment (import.meta.env)                   â”‚
â”‚                                                          â”‚
â”‚  VITE_SUPABASE_PROJECT_ID                               â”‚
â”‚  â””â”€> "qlhpzsucftqcakiotgpc"                             â”‚
â”‚                                                          â”‚
â”‚  VITE_SUPABASE_PUBLISHABLE_KEY                          â”‚
â”‚  â””â”€> "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."         â”‚
â”‚                                                          â”‚
â”‚  VITE_SUPABASE_URL                                      â”‚
â”‚  â””â”€> "https://qlhpzsucftqcakiotgpc.supabase.co"        â”‚
â”‚                                                          â”‚
â”‚  âš ï¸  Non-VITE_ vars NOT available in browser            â”‚
â”‚  SUPABASE_SERVICE_ROLE_KEY â””â”€ Backend only!            â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â”‚ Used by:
                          â”‚ generateProductFromImage.ts
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  generateProductFromImage.ts                             â”‚
â”‚                                                          â”‚
â”‚  const supabaseAnonKey =                                â”‚
â”‚    import.meta.env.VITE_SUPABASE_PUBLISHABLE_KEY        â”‚
â”‚                                                          â”‚
â”‚  const supabaseProjectId =                              â”‚
â”‚    import.meta.env.VITE_SUPABASE_PROJECT_ID             â”‚
â”‚                                                          â”‚
â”‚  âœ… Now available for:                                   â”‚
â”‚    - URL construction                                    â”‚
â”‚    - Header authentication                              â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 4. Error Handling Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  handleAutofillFromImages()  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Validations  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
        â”‚             â”‚
        â–¼             â–¼
    No images?    No store?
        â”‚             â”‚
        â–¼             â–¼
     âŒ Toast     âŒ Toast
    "Upload at   "Select a
     least one   store
     image"      first"
        â”‚             â”‚
        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
     â”Œâ”€ Call generateProductFromImage()
     â”‚
     â–¼
generateProductFromImage()
â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚              â”‚
         â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
         â”‚ Success â”‚     â”‚  Error  â”‚
         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
              â”‚              â”‚
              â–¼              â–¼
         Return:         Return:
        {success:       {success:
         true,           false,
         generated:      error:
         {...}}          "message"}
              â”‚              â”‚
              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
          Back to AddProductPage
                     â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                     â”‚
      âœ… Success              âŒ Error
          â”‚                     â”‚
          â–¼                     â–¼
      Update form          Show toast
      with AI data         Show error
          â”‚                     â”‚
          â–¼                     â–¼
      Success toast       Console log
          â”‚                     â”‚
          â–¼                     â–¼
      Seller sees         Seller knows
      populated           what went
      form               wrong
```

## 5. Component Dependencies

```
AddProductPage.tsx
â”‚
â”œâ”€ useOutletContext<Store>
â”‚
â”œâ”€ useToast()
â”‚
â”œâ”€ useLanguage()
â”‚  â””â”€ LanguageContext
â”‚
â”œâ”€ useCreateProduct()
â”‚
â”œâ”€ useTranslationMutations()
â”‚
â”œâ”€ generateProductFromImage() â­ FIXED
â”‚  â””â”€ import.meta.env
â”‚     â”œâ”€ VITE_SUPABASE_PUBLISHABLE_KEY
â”‚     â””â”€ VITE_SUPABASE_PROJECT_ID
â”‚
â”œâ”€ translateText()
â”‚
â””â”€ supabase (Supabase Client)
   â”œâ”€ auth.getUser()
   â”œâ”€ storage.upload()
   â”œâ”€ storage.getPublicUrl()
   â””â”€ from('table').select/update()
```

## 6. State Management Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AddProductPage State            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                 â”‚
â”‚  formData                        â”‚
â”‚  â”œâ”€ slug                         â”‚
â”‚  â”œâ”€ price                        â”‚
â”‚  â”œâ”€ originalPrice                â”‚
â”‚  â”œâ”€ stock                        â”‚
â”‚  â”œâ”€ categoryId                   â”‚
â”‚  â”œâ”€ description                  â”‚
â”‚  â”œâ”€ enName                       â”‚
â”‚  â”œâ”€ enDescription                â”‚
â”‚  â”œâ”€ arName        â­ Populated   â”‚
â”‚  â””â”€ arDescription â­ by Autofill â”‚
â”‚                                 â”‚
â”‚  generatingFromImage             â”‚
â”‚  â””â”€ true during AI processing    â”‚
â”‚                                 â”‚
â”‚  uploadedImages[]                â”‚
â”‚  â””â”€ Array of image URLs          â”‚
â”‚                                 â”‚
â”‚  categories[]                    â”‚
â”‚  â””â”€ Fetched from database        â”‚
â”‚                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ handleAutofillFromImages()
         â”‚
         â–¼
    generateProductFromImage(
      image,
      language,
      storeId
    )
         â”‚
         â–¼
    Response: {
      success: true,
      generated: {
        en: { name, description, slug },
        ar: { name, description }
      }
    }
         â”‚
         â–¼
    setFormData(prev => ({
      ...prev,
      enName: generated.en.name,
      enDescription: generated.en.description,
      arName: generated.ar.name,
      arDescription: generated.ar.description
    }))
         â”‚
         â–¼
    Component re-renders âœ…
    User sees populated form âœ…
```

## 7. Header Authentication Details

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Supabase Authentication Headers                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                 â”‚
â”‚  Authorization Header (OAuth 2.0)              â”‚
â”‚  â”œâ”€ Format: "Bearer {token}"                   â”‚
â”‚  â”œâ”€ Token: JWT from Supabase                   â”‚
â”‚  â”œâ”€ Purpose: Proves authentication             â”‚
â”‚  â””â”€ Used by: Edge Function, Supabase           â”‚
â”‚                                                 â”‚
â”‚  apikey Header (Supabase Specific)             â”‚
â”‚  â”œâ”€ Format: "{token}"                          â”‚
â”‚  â”œâ”€ Token: Same JWT                            â”‚
â”‚  â”œâ”€ Purpose: Additional auth layer             â”‚
â”‚  â””â”€ Used by: Some Supabase services            â”‚
â”‚                                                 â”‚
â”‚  x-client-info Header (Custom)                 â”‚
â”‚  â”œâ”€ Format: "string"                           â”‚
â”‚  â”œâ”€ Value: "gocart-frontend"                   â”‚
â”‚  â”œâ”€ Purpose: Identify client                   â”‚
â”‚  â””â”€ Used by: Logging, debugging                â”‚
â”‚                                                 â”‚
â”‚  Content-Type Header (HTTP Standard)           â”‚
â”‚  â”œâ”€ Format: "application/json"                 â”‚
â”‚  â”œâ”€ Purpose: Describes body format             â”‚
â”‚  â””â”€ Used by: Server parsing                    â”‚
â”‚                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 8. API Call Lifecycle

```
User Action:
Click "Autofill" button
    â”‚
    â–¼
handleAutofillFromImages() called
    â”‚
    â”œâ”€ Validation 1: Image uploaded?
    â”‚  â””â”€ No: Toast error, return
    â”‚
    â”œâ”€ Validation 2: Store selected?
    â”‚  â””â”€ No: Toast error, return
    â”‚
    â”œâ”€ Set loading state: generatingFromImage = true
    â”‚
    â–¼
generateProductFromImage(image, lang, storeId) called
    â”‚
    â”œâ”€ Load env variables from import.meta.env
    â”‚
    â”œâ”€ Validate inputs
    â”‚
    â”œâ”€ Construct URL using projectId
    â”‚
    â”œâ”€ Build fetch request with ALL headers âœ…
    â”‚
    â–¼
fetch() Network Request
    â”‚
    â”œâ”€ Send to Supabase Edge Function
    â”‚
    â”œâ”€ Edge Function validates CORS headers
    â”‚
    â”œâ”€ Edge Function calls OpenAI API
    â”‚
    â”œâ”€ OpenAI analyzes image
    â”‚
    â”œâ”€ Edge Function returns JSON response
    â”‚
    â–¼
Response received in browser
    â”‚
    â”œâ”€ Parse JSON
    â”‚
    â”œâ”€ Check if response.ok && data.success
    â”‚
    â”œâ”€ If error: throw Error with message
    â”‚
    â–¼
Back in generateProductFromImage()
    â”‚
    â”œâ”€ Return { success: true, generated: {...} }
    â”‚  or
    â”œâ”€ Return { success: false, error: "message" }
    â”‚
    â–¼
Back in handleAutofillFromImages()
    â”‚
    â”œâ”€ Check if success
    â”‚  â”‚
    â”‚  â”œâ”€ Yes: Update form state
    â”‚  â”‚   â””â”€ Show success toast
    â”‚  â”‚
    â”‚  â””â”€ No: Show error toast
    â”‚
    â”œâ”€ Set loading state: generatingFromImage = false
    â”‚
    â–¼
Component re-renders
    â”‚
    â–¼
UI Updated
    â”œâ”€ Form fields populated (success)
    â”‚  or
    â””â”€ Error message shown (failure)
```

---

This visual documentation provides complete understanding of how the autofill feature works at every level.
